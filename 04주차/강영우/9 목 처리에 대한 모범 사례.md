# 9. 목 처리에 대한 모범 사례

## 목의 가치를 극대화 하기

- 목은 비관리 의존성에만 적용 해야한다.
    - 그리고 시스템 끝에서 상호작용을 검증해야한다.

![Untitled](9%20%E1%84%86%E1%85%A9%E1%86%A8%20%E1%84%8E%E1%85%A5%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A6%20%E1%84%83%E1%85%A2%E1%84%92%E1%85%A1%E1%86%AB%20%E1%84%86%E1%85%A9%E1%84%87%E1%85%A5%E1%86%B7%20%E1%84%89%E1%85%A1%E1%84%85%E1%85%A8%20b84b56e7328245809ade55e8b9a72d96/Untitled.png)

- IMessageBus를 모킹하지 말고, IBus를 모킹해야한다. 그러면 회귀 방지에 효과가 있음
- 목을 스파이로 대체해라

## 목을 스파이로 교체하기

- 시스템 끝에 있는 클래스의 경우는 스파이가 목보다 낫다
- 네이밍도 혼선을 피하기 위해 ~mock이 아닌 ~spy로 해주자
- 테스트에서 검증문을 작성할 때 제품코드에 의존하면 안된다.
- 테스트는 감시자!!!!

## 목 처리에 대한 모범 사례

- 비관리 의존성에만 목 적용하기
- 시스템 끝에 있는 의존성에 대해 상호작용 검증하기
- 통합테스트에서만 목을 사용하고 단위 테스트에서는 하지 않기
    - 통합 테스트에서 컨트롤러를 테스트 할 때만 목을 적용해야한다.
    - 단위 테스트는 도메인 테스트!
- 항상 목 호출 수 확인하기
    - 예상한 호출이 있는지 확인 필요함
    - 예상치 못한 호출이 없는지 확인 필요함
- 보유 타입만으로 목 처리하기
    - 어댑터를 장착하고 이 어댑터를 목으로 처리해야 한다.
    - 어댑터를 통해
        - 기본 라이브러리의 복잡성을 추상화하고, 라이브러리에서 필요한 기능만 노출하며, 프로젝트 도메인 언어를 사용해 수행할 수 있다.