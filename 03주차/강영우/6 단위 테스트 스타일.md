# 6. 단위 테스트 스타일

# 단일 테스트 스타일 비교

- 출력기반: 제일 좋음. 순수 함수 방식으로 작성된 코드에만 적용된다.
    - 테스트 대상 시스템에 입력을 넣고 생성되는 출력을 점검하는 방식
    - 거짓 양성 방지 제일 우수함
    - 유지보수 제일 용이함
- 상태기반: 두번째로 좋음
    - 작업이 완료된 후 시스템 상태를 확인하는 것
    - 거짓양성이 되기 쉬움
    - 유지보수 쉽지않다.
- 통신기반: 간헐적으로 사용해야함
    - 목을 사용해 테스트 대상 시스템과 협력자 간의 통신을 검증한다.
    - 허위 경보에 가장 취약하다.
    - 유지보수 힘들다.

# 함수형 아키텍처와 육각형 아키텍처의 관계

- 함수형 프로그래밍
    - 수학적 함수를 사용한 프로그래밍이다.
    - 숨은 입출력이 없는 함수
    - 입출력을 명시한 수학적 함수는 이에 따르는 테스트가 짧고 간결하며 이해하고 유지보수하기 쉬우므로 테스트하기가 매우 쉽다.
- 함수형 아키텍처
    - 두 가지 코드 유형을 구분해서 비즈니스 로직과 사이드 이펙트를 분리할 수 있다.
        - 함수형 코어(결정을 내리는 코드): 이 코드는 사이드 이펙트가 필요 없기 때문에 수학적 함수를 사용해 작성할 수 있다
        - 가변 셸(해당 결정에 따라 작용하는 코드): 이 코드는 수학적 함수에 의해 이뤄진 모든 결정을 데이터베이스의 변경이나 메시지 버스로 전송된 메시지와 같이 가시적인 부분으로 변환한다.
    - 함수형 코어와 가변 셸의 협력 방식
        - 가변셸은 모든 입력을 수집한다.
        - 함수형 코어는 결정을 생성한다.
        - 셸은 결정을 사이드 이펙트로 변환한다.
- 함수형 아키텍처와 육각형 아키텍처 비교
    - 공통점
        - 관심사 분리라는 아이디어를 기반으로 한다.
        - 의존성간의 단방향 흐름이다.
    - 차이점
        - 사이드 이펙트에 대한 처리
            - 함수형 아키텍처는 모든 사이드이펙트를 불변 코어에서 비즈니스 연산 가장자리로 밀어낸다.
                - 이 가장자리는 가변 셸이 처리한다.
            - 육각형 아키텍처는 도메인 계층에 제한하는 한 도메인 계층으로 인한 사이드 이펙트도 문제 없다.

# 출력 기반 테스트로 전환

- 두 리팩터링 단계로 진행된다.
    1. 프로세스 외부 의존성에서 목으로 변경
    2. 목에서 함수형 아키텍처로 변경