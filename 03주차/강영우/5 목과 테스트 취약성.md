# 5. 목과 테스트 취약성

- 테스트는 “어떻게”가 아닌 “무엇”에 집중해야 한다.
- API를 잘 설계하면 단위 테스트도 자동으로 좋아진다.

# 목과 스텁 구분

- 목: 외부로 나가는 상호 작용을 모방하고 검사하는 데 도움이 된다. 이러한 상호작용은 SUT가 상태르 변경하기 위한 의존성을 호출하는 것에 해당한다.
    - 목, 스파이
        - 스파이는 수동 작성
        - 목은 프레임워크의 도움을 받아 생성
- 스텁: 내부로 들어오는 상호작용을 모방하는 데 도움이 된다. 이러한 상호 작용은 SUT가 입력 데이터를 얻기 위한 의존성을 호출하는 것에 해당한다.
    - 스텁, 더미, 페이크
        - 얼마나 똑똑하느냐에 따라 다름
        - 더미: 널값이나 가짜 문자열 같이 하드코딩된 값
        - 스텁: 시나리오마다 다른 값을 반환하게 끔 구성할 수 있는 완전 다 갖춘 의존성이다.
        - 페이크: 대다수에 목적에 부합하는 스텁과 같다. 보통 아직 존재하지 않는 의존성을 대체하고자 구현한다.
- 메서드관점
    - 목은 명령에 속한다. 사이드이펙트를 초래하고, 반환값이 없다
    - 스텁은 조회에 속한다. 사이드이펙트를 초래하고, 값을 반환한다.

# 식별할 수 있는 동작과 구현 세부 사항 정의

- 코드가 시스템의 식별할 수 있는 동작이려면 다음 중 하나를 해야한다.
    - 클라이언트가 목표를 달성하는 데 도움이 되는 연산을 노출하라. 연한은 계산을 수행하거나 사이드 이펙트를 초래하거나 둘 다 하는 메서드다
    - 클라이언트가 목표를 달성하는 데 도움이 되는 상태를 노출하라. 상태는 시스템의 현재 상태다.
- 세부 구현 사항은 위 두가지 중 아무 것도 하지 않는다.
- 식별할 수 있는 동작인지 여부는 해당 클라이언트가 누구인지, 그리고 해당 클라이언트의 목표가 무엇인지에 달려있다. 식별할 수 있는 동작이 되려면 코드가 이러한 목표 중 하나에라도 직접적인 관계가 있어야 한다.

# 목과 테스트 취약성 간의 관계 이해

- 런던파를 따라 목을 무분별하게 사용하면 구현 세부사항에 강하게 겹합되어 테스트에 리팩터링 내성이 없게 된다.
- 고전파는 테스트 간에 공유하는 의존성만 교체하자고 하므로 이 문제에 훨씬 유리하다.

# 리팩터링 내성 저하 없이 목 사용하기